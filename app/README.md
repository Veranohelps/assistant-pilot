# Dersu Assistant mobile app

The Dersu Assistant app is built using [Flutter](https://flutter.dev/) for both Android and iOS.

## Development

You have to get the configuration file and Android signing key from GCP's Secret Manager. You can do so manually or running the following commands (requires `gcloud` installed and initialised and being able to access the project in GCP, including Secret Manager Secret Accessor role):

```
gcloud secrets versions access 3 --secret="develop-app-configuration" > app/.env
gcloud secrets versions access 2 --secret="develop-app-android-jks" > app/android/app/sign/android-key.b64
base64 -d app/android/app/sign/android-key.b64 > app/android/app/sign/android-key.jks
flutter pub get
flutter run
```

Check the main [README](../readme.md) for more info.

Packages, libraries and plugins in use:

- [Bloc](https://bloclibrary.dev) for state management.
- [getIt](https://github.com/fluttercommunity/get_it) as a service locator.
- [Hive DB](https://docs.hivedb.dev) NoSql key-value database written in Dart.
- [flutter_appauth](https://pub.dev/packages/flutter_appauth) A Flutter bridge for AppAuth. 

## Release

###Android

Build and deploy to Google Play's alpha branch triggering a manual run of the [Android Release workflow](https://github.com/dersu-uz/assistant-pilot/actions/workflows/android-release.yml) using the `develop` branch.

### iOS

Requires [Codemagic CLI tools](https://github.com/codemagic-ci-cd/cli-tools) and [xcpretty](https://github.com/xcpretty/xcpretty), Xcode command line tools and signing certificates in place ([more info](https://flutter.dev/docs/deployment/ios)).

- Manually run [iOS build action](https://github.com/dersu-uz/assistant-pilot/actions/workflows/ios-build.yml) using the `develop` branch.
- Download `Runner.app` from artifacts to `app/build/ios/iphoneos/`
- `xcode-project build-ipa --export-options-plist ios/export.plist  --workspace ios/Runner.xcworkspace --scheme Runner --config Release` (note the generated *.xcarchive file in `build/ios/xcarchive/`).
- `open build/ios/xcarchive/XXXXXXX.xcarchive` and follow the click through process to sign and upload to App Store Connect. 

NOTE: `ios/export.plist` generated by running `xcode-project use-profiles --export-options-plist ios/export.plist --custom-export-options='{"signingStyle":"automatic"}'`.

## Misc

LocaleKeys generation: 
`$ flutter pub run easy_localization:generate --source-dir ./assets/translations -f keys -o locale_keys.g.dart`

Also see notes about [Auth0 configuration](../docs/identity.md).